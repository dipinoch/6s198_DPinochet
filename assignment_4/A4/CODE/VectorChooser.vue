<!-- Contributed by David Bau, in the public domain -->

<template>
<div class="vectorlist">
  <div v-for="(vector, index) in vectors" class="vector">
    <input v-model="vector.text">
    <button @click="selectVector(index)">&rarr;</button>
    <button @click="deleteVector(index)">x</button>
  </div>
  <div class="operation">
  <button @click="saveVector()">Save current sample</button>
  </div>
  <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyVectorMath()">Apply vector math</button>
  </div>

  <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath()">Apply edge Smooth</button>
  </div>
  <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath2()">Apply 'curvy' style</button>
  </div>
  <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath3()">Apply 'thinner' style</button>
  </div>
   <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath4()">Apply 'Serify' style</button>
  </div>
   <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath5()">Apply 'squareIsh' style</button>
  </div>
  <div class="operation">
  <!-- TODO: Change this button to do something interesting -->
  <button @click="applyOtherMath6()">Apply 'averaged' style</button>
  </div>
  <div class="operation">  
  <button @click="getKNN()">Get Knn ID</button>
  </div>
  <div class="operation">  
  <button @click="FindAverageVector()">find Average Vector</button>
  </div>
   <div class="operation">  
  <button @click="FindChosenAverageVector()">find Chosen Style Vector</button>
  </div>
</div>
</template>

<script>
import {Array1D, ENV} from 'deeplearn';
import SampleVue from './Sample.vue';
import { isArray } from 'util';

const math = ENV.math;
var normProdsAll= new Array();
var dotProductsAll= new Array();
var maxVal; 
var similarities= new Array();
var AverageVec= new Array();
var AverageVecNew= new Array();

var selectedFonts= new Array();

var sFonts1= new Array();
var sFonts2= new Array();


//This json file includes all of the Font IDs in our database and their 40-dimensional logits vector.
var json = require('../embeddings.json');

var indexes1 = [1200,4169,6992,4234,6690,1815,663,2199,7725,7358]; // vectors to get a more cursive style. 
var indexes2 = [1711,3966,3965,4546,4569,1472,4545,4897,3010,2650]; //vectors for a thinner look
var indexes3 = [6433,7092,7093,3000,3495,1873,5137,3494,4114,5018]; //Bold fonts. 
var indexes4 = [6690, 1701,1347,1699,6692,6063,3258,8011,6891,2074]; //Bold fonts. 


var newstyle1= new Array();
var newstyle2= new Array();
var newstyle3= new Array();
var newstyle4= new Array();
var newstyle5= new Array();
 var selectedStyles= new Array();
//create array with chosen fonts for this assignment
function CreateFontArray(){
    for(var i=0; i< indexes4.length; i++){
            selectedFonts.push(json[indexes4[i]]);        
    }
  
  //console.log(selectedFonts);
  ;}

//function to multiply norms
function multiplyNorms(arrayA, arrayB){
        var NormProduct= new Array();

        for(var i=0; i< arrayB.length; i++){ 
          NormProduct.push(arrayA[i] *arrayB[i]);
        
        }
      return NormProduct;      

}

//find the average vector of all vectors 
function averageVector(nArrays){
  var tempval=0;
  var tempval2;
  var c=0;
  var tempVals= new Array();
  
  for (var i=0; i< nArrays[0].length; i++){
    nArrays.forEach(element => {
      
    tempval += element[c];
    
    
    //console.log(tempval2);
  });
  tempval2=(tempval/nArrays.length)/5;
  c++;

  AverageVec.push(tempval2);
  }    
  return AverageVec;
}


//find the average vector of all vectors using the method with two oposite styles. 
function averageVector2(arrayA, arrayB){
  var tempVAL=0;

  for (var i=0; i< arrayA.length; i++){
      tempVAL= (arrayA[i] - arrayB[i])/2
      AverageVecNew.push(tempVAL);

  }

  return AverageVecNew;
}


//to empty any array 
function empty(list) {
    //empty your array
    list=[];
}

//function to calculate the similarity of the 50 K fonts. 
function calculateSimilarity(A,B){        
        var dotproduct=0;
        var mA=0;
        var mB=0;

        for(var i = 0; i < A.length;i++){
            dotproduct += (A[i] * B[i]);
            mA += (A[i]*A[i]);
            mB += (B[i]*B[i]);
        }
        mA = Math.sqrt(mA);
        mB = Math.sqrt(mB);
        var similarity = Math.abs((dotproduct)/(mA)*(mB));
        return similarity;        
    }

function createNewstyles(){

newstyle1= [-0.0008731250371783972, -0.0012172140399707133, -0.0011899102197276078, -0.0017212872577147208, -0.0014704951501698816, -0.0021142564571709956, -0.001421918654559704, -0.0022326515565873704, -0.0015957081705346354, -0.0024418332256391294, -0.002492286899687315, -0.002308785105451534, -0.0023963170292336145, -0.0033217509257156053, -0.0028558435550439755, -0.0025830046579721965, -0.003911339596706967, -0.004410946109310317, -0.004409494446335884, -0.006066552800803038, -0.0060901036250652395, -0.006916497681268083, -0.006779385135487246, -0.006271561825160461, -0.004873486564938503, -0.00516605715474725, -0.004304848729843797, -0.00427238415551983, -0.0057454366106321686, -0.005373769056495803, -0.004880250087917375, -0.00466741590968013, -0.003940036596941354, -0.004466461327137949, -0.004232494047937507, -0.004258771898785199, -0.003726126054862107, -0.003186819317379559, -0.004709445700609649, -0.003936370688788884];
newstyle2 =  [-0.006121422289870679, 0.0030234401719644666, 0.011510099400766194, 0.017704266640357673, 0.02589136518072337, 0.02429405221249908, 0.017600559564307332, 0.03137035232968628, 0.05251345091499389, 0.054305788848723745, 0.053590045271848796, 0.05619275985605782, 0.06506587745941943, 0.07753688032127684, 0.080966836589796, 0.07453325991838937, 0.057146950041351376, 0.033136333649454175, 0.032051823226211126, 0.017003276789037045, 0.01793669754493749, -0.01849734699499095, -0.021262825347075704, -0.002038295335660223, 0.010456580378522632, 0.019433614749868867, 0.01932800201670034, 0.008524163867987227, 0.003601127039582934, 0.007013380914868321, 0.03772562408441445, 0.04543855738447746, 0.029012497184739916, 0.02360395598778268, 0.016048885971249545, 0.02065443388040876, 0.013010597506945488, 0.008665294203383382, -0.0158383524385863, -0.03428505129792029];
newstyle3= [-0.009333710093051195, -0.010041171964257956, 0.002026583775877953, 0.004390437093097717, -0.002908118104096502, -0.0006528402678668499, 0.010210483241826296, -0.0021088358573615553, 0.013426049519330263, 0.004942423775792122, -0.004810995552688837, -0.009005028363317251, -0.004181428174488246, 0.0005316135333850979, 0.00032501163426786663, -0.0008727882197126747, -0.01762607955839485, -0.03267286551650613, -0.024295305248815565, -0.035319619711954145, -0.054604259219486265, -0.07885556959779934, -0.09168056943686678, -0.08300264575751498, -0.060284258213359865, -0.06498409046442248, -0.06916578689240852, -0.06404254389781272, -0.06356666159670568, -0.05693419635950704, -0.0579471655022644, -0.052040935169934535, -0.05555368238317897, -0.0561347305001982, -0.05050086246061255, -0.04006551576036145, -0.03042385728287627, -0.035343930890812766, -0.04212971849556198, -0.029141809683787868];
newstyle4= [-0.0004967576637864113, 0.0031351277045905588, 0.012199134617112577, 0.014661063537932933, 0.01763676163274795, 0.017485498231835664, 0.013735461267642676, 0.024337555491365494, 0.03293058041948825, 0.022411951250396668, 0.01697980964090675, 0.025117702824063597, 0.038594844244653356, 0.03969632333726622, 0.04423933014390059, 0.04130501814302988, 0.03543440418434329, 0.02748026823741384, 0.028780146801145746, 0.02050725177046843, 0.01743118226644583, 0.0060273546783719215, 0.006636706251883879, 0.0060798124189022935, 0.018974332442739977, 0.027875341988401487, 0.02982360258407425, 0.027186366400565022, 0.03206149029254447, 0.032039808772387914, 0.04325331903237384, 0.04553456890804227, 0.04560800319944974, 0.04126372761500534, 0.043957384228124285, 0.04134054418595042, 0.04557400796969887, 0.03589761661773082, 0.030017054941854436, 0.026841822154237888];
newstyle5=  [-0.008041767813265325, -0.02534190960228443, -0.0406635220348835, -0.04671103287488222, -0.0572743927501142, -0.06473124578595162, -0.053489068550989026, -0.06672886851243674, -0.08397999483160674, -0.07151114649139345, -0.06636251734104007, -0.07156242236495018, -0.08825967863202096, -0.08445488944649696, -0.09528344700112938, -0.0750236607529223, -0.04066495219245553, -0.01710948536172509, -0.015520316120237113, 0.0110383708961308, 0.016787018245086074, 0.05052850670181215, 0.0511904142331332, 0.03652560882270336, 0.021292170276865363, 0.015417313417419792, 0.0046261186245828865, 0.00988889531698078, 0.01163730280008167, 0.005343443606980145, -0.01553947828244418, -0.009477479658089578, -0.007284970371983945, 0.012774278256110846, 0.02422952712047845, 0.009872090769931674, 0.0027918887976557017, 0.010921099400147797, 0.03822331122122705, 0.04513072577305138];

selectedStyles.push(newstyle1);
selectedStyles.push(newstyle2);
selectedStyles.push(newstyle3);
selectedStyles.push(newstyle4);
selectedStyles.push(newstyle5);
}



export default {
  props: {
    selectedSample: { },
    model: { },
    vectors: { type: Array, default: () => [ { text: "0" } ] }
  },
  methods: {
    saveVector() {
      this.selectedSample.data().then(x =>
         this.vectors.push({ text: Array.prototype.slice.call(x).join(',') })
      );
    },
    deleteVector(index) {
      this.vectors.splice(index, 1);
    },
    selectVector(index) {
      this.$emit("select", { selectedSample: this.model.fixdim(
           Array1D.new(this.vectors[index].text.split(',').map(parseFloat)))});
    },
    // TODO: Add useful vector space operations here -->
    applyVectorMath() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new([0.053,0.026,-0.060,-0.014,-0.093,-0.018,0.087,0.096,-0.039,0.071,0.111,-0.022,-0.007,0.022,-0.032,0.141,0.126,-0.015,-0.075,0.120,0.068,0.021,0.104,-0.065,-0.085,-0.018,-0.038,-0.059,-0.051,-0.056,0.154,-0.044,-0.116,0.038,-0.144,-0.103,-0.032,0.059,-0.076,-0.030]))) } )

    },

    applyOtherMath() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new([-0.0008731250371783972, -0.0012172140399707133, -0.0011899102197276078, -0.0017212872577147208, -0.0014704951501698816, -0.0021142564571709956, -0.001421918654559704, -0.0022326515565873704, -0.0015957081705346354, -0.0024418332256391294, -0.002492286899687315, -0.002308785105451534, -0.0023963170292336145, -0.0033217509257156053, -0.0028558435550439755, -0.0025830046579721965, -0.003911339596706967, -0.004410946109310317, -0.004409494446335884, -0.006066552800803038, -0.0060901036250652395, -0.006916497681268083, -0.006779385135487246, -0.006271561825160461, -0.004873486564938503, -0.00516605715474725, -0.004304848729843797, -0.00427238415551983, -0.0057454366106321686, -0.005373769056495803, -0.004880250087917375, -0.00466741590968013, -0.003940036596941354, -0.004466461327137949, -0.004232494047937507, -0.004258771898785199, -0.003726126054862107, -0.003186819317379559, -0.004709445700609649, -0.003936370688788884]))) } )
    },

     applyOtherMath2() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new(  [-0.006121422289870679, 0.0030234401719644666, 0.011510099400766194, 0.017704266640357673, 0.02589136518072337, 0.02429405221249908, 0.017600559564307332, 0.03137035232968628, 0.05251345091499389, 0.054305788848723745, 0.053590045271848796, 0.05619275985605782, 0.06506587745941943, 0.07753688032127684, 0.080966836589796, 0.07453325991838937, 0.057146950041351376, 0.033136333649454175, 0.032051823226211126, 0.017003276789037045, 0.01793669754493749, -0.01849734699499095, -0.021262825347075704, -0.002038295335660223, 0.010456580378522632, 0.019433614749868867, 0.01932800201670034, 0.008524163867987227, 0.003601127039582934, 0.007013380914868321, 0.03772562408441445, 0.04543855738447746, 0.029012497184739916, 0.02360395598778268, 0.016048885971249545, 0.02065443388040876, 0.013010597506945488, 0.008665294203383382, -0.0158383524385863, -0.03428505129792029]))) } )

    },

    applyOtherMath3() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new([-0.009333710093051195, -0.010041171964257956, 0.002026583775877953, 0.004390437093097717, -0.002908118104096502, -0.0006528402678668499, 0.010210483241826296, -0.0021088358573615553, 0.013426049519330263, 0.004942423775792122, -0.004810995552688837, -0.009005028363317251, -0.004181428174488246, 0.0005316135333850979, 0.00032501163426786663, -0.0008727882197126747, -0.01762607955839485, -0.03267286551650613, -0.024295305248815565, -0.035319619711954145, -0.054604259219486265, -0.07885556959779934, -0.09168056943686678, -0.08300264575751498, -0.060284258213359865, -0.06498409046442248, -0.06916578689240852, -0.06404254389781272, -0.06356666159670568, -0.05693419635950704, -0.0579471655022644, -0.052040935169934535, -0.05555368238317897, -0.0561347305001982, -0.05050086246061255, -0.04006551576036145, -0.03042385728287627, -0.035343930890812766, -0.04212971849556198, -0.029141809683787868]))) } )

    },


    applyOtherMath4() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new( [-0.013737435825169087, -0.006836545690894128, 0.004470429047942161, 0.01132254522293806, 0.020221307072788477, 0.0127142254402861, 0.013338779252953828, 0.029879772015847267, 0.037508842521347105, 0.0346342230468872, 0.03719168990588514, 0.03423331512341975, 0.04123993080778746, 0.04789879869407741, 0.057686715398158415, 0.048846600886608936, 0.030073636334564068, 0.009382703166629654, 0.007995161877188366, -0.009612559511151631, -0.0074123603318003006, -0.045297944716003256, -0.05243309558631154, -0.04279756647796603, -0.030275774051260668, -0.025471080618735868, -0.030851732415903825, -0.03657157536392333, -0.03490754707861925, -0.03371684447629377, -0.010644130862783641, -0.0029147445387206973, -0.010070640274789185, -0.013987952943425624, -0.011890686678525527, -0.012396860060107429, -0.010593878452491481, -0.016175343313079793, -0.03449923976586433, -0.04305170353763969]))) } )

    },
    applyOtherMath5() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new(  [-0.008041767813265325, -0.02534190960228443, -0.0406635220348835, -0.04671103287488222, -0.0572743927501142, -0.06473124578595162, -0.053489068550989026, -0.06672886851243674, -0.08397999483160674, -0.07151114649139345, -0.06636251734104007, -0.07156242236495018, -0.08825967863202096, -0.08445488944649696, -0.09528344700112938, -0.0750236607529223, -0.04066495219245553, -0.01710948536172509, -0.015520316120237113, 0.0110383708961308, 0.016787018245086074, 0.05052850670181215, 0.0511904142331332, 0.03652560882270336, 0.021292170276865363, 0.015417313417419792, 0.0046261186245828865, 0.00988889531698078, 0.01163730280008167, 0.005343443606980145, -0.01553947828244418, -0.009477479658089578, -0.007284970371983945, 0.012774278256110846, 0.02422952712047845, 0.009872090769931674, 0.0027918887976557017, 0.010921099400147797, 0.03822331122122705, 0.04513072577305138]))) } )

    },
applyOtherMath6() {
      this.$emit("select", { selectedSample:
           math.add(this.selectedSample, this.model.fixdim(
               Array1D.new( [0.0009601727616973229, 0.014182674887124448, 0.026086810717824847, 0.032207649757619944, 0.04158287896541878, 0.04451264899922535, 0.03554481405764818, 0.04904961042106151, 0.06824672287330032, 0.0629084676700586, 0.05997628130644443, 0.063877591110504, 0.07666277804572019, 0.0809958848838869, 0.08812514179546269, 0.07477846033565583, 0.04890595111690345, 0.02512290950558963, 0.02378606967322412, 0.0029824529464531225, 0.0005748396499257076, -0.03451292684840155, -0.03622661979010445, -0.01928195207918179, -0.005417794949171366, 0.0020081506662245376, 0.007350941696058726, -0.0006823657244967767, -0.004018087880249368, 0.0008349686539440883, 0.026632551183429314, 0.02745801852128352, 0.01814873377836193, 0.005414838865835918, -0.004090320574614453, 0.005391171555238543, 0.005109354354644893, -0.0011279025983822076, -0.027030831829906676, -0.03970788853548583]
))) } )

    },



    //TODO: Implement getKNN to output the font ID of the nearest neighbor
  getKNN() {
  
  var v= Promise.resolve(this.selectedSample.data());   

   v.then(function(value){
          //dotProductsAll=[];
          for (var i=0; i <json.length; i++){
                  similarities.push(calculateSimilarity(value, json[i]));
                 // console.log(value);
          }
      });

    var i = similarities.indexOf(Math.min(...similarities));

    // console.log(i);
    // console.log(similarities);
    similarities.splice(0);
    },

  FindAverageVector(){
      CreateFontArray();
      //console.log(averageVector(json));
      console.log(averageVector(selectedFonts));
      AverageVec.splice(0);
  },


  FindChosenAverageVector(){
     createNewstyles();
     averageVector2(selectedStyles[1],selectedStyles[4]);
     console.log(AverageVecNew);
     AverageVecNew.splice(0);
  },

  watch: {
    model: function(val) {
      for (let i = 0; i < this.vectors.length; ++i) {
        let arr = this.vectors[i].text.split(',');
        if (arr.length > this.model.dimensions) {
            arr = arr.slice(0, this.model.dimensions);
        }
        while (arr.length < this.model.dimensions) {
            arr.push('0');
        }
        this.vectors[i].text = arr.join(',');
      }
    }
  },  
}
}
</script>

<style scoped>
.vector, .operation {
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  white-space: nowrap;
}

</style>
